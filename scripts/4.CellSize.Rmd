---
title: "Evolution of the minimal cell"
author: "Roy Moger-Reischer and Jay T. Lennon"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
   - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

## Making Figure 4: changes in cell size

## Clear workspace and set directory
```{r setup}
rm(list=ls())
getwd()
setwd("~/GitHub/MinimalCell")
```

## Load packages and functions
```{r}
require("png")
require("dplyr")
require("grid")
sem <- function(x) sqrt(var(x)/length(x))
```

# Load and process data
```{r}
# Load data
size.raw <-read.csv("data2/cases_microbeJ.csv")
size.raw <- as_tibble(size.raw)
colnames(size.raw) <- c("strain", "timepoint", "sub.strain", "diameter", "area", 
    "volume", "pixels", "mean", "min", "max")
size <- size.raw %>% group_by(strain, timepoint) %>% summarise(mean = mean(volume), sem = sem(volume))
size$strain <- as.factor(size$strain)
size$timepoint <- as.factor(size$timepoint)

# Add x-values for plotting
time.x <- c(1,3,1,3)
size <- data.frame(size, time.x)

# Subset relative fitness by strain
size.wt  <- filter(size, strain == "Wildtype") %>%
  dplyr::select(timepoint, mean, sem, time.x)

size.min  <- filter(size, strain== "Minimal") %>%
  dplyr::select(timepoint, mean, sem, time.x)
```

## Two-way ANOVA
```{r}
# Convert timepoint and strain to factor
size.raw$timepoint<- as.factor(size.raw$timepoint)
size.raw$strain<- as.factor(size.raw$strain)

# Two-way ANOVA on fitness (W)
size.anova <- aov(volume ~ timepoint + strain + timepoint*strain, data = size.raw)

#                   Df Sum Sq Mean Sq F value   Pr(>F)    
# timepoint          1   7.28   7.278   84.61  < 2e-16 ***
# strain             1  16.37  16.366  190.25  < 2e-16 ***
# timepoint:strain   1   2.95   2.948   34.27 9.92e-09 ***
# Residuals        404  34.75   0.086                     
```

# Initiate figure
```{r}
# Make figure
png(filename="~/GitHub/MinimalCell/figures/Fig4.png",
    width = 1200, height = 1200, res = 96*2) 

plot.new()
par(mar = c(7, 7, 5, 7))

# Add wildtype points
plot(size.wt$time.x, size.wt$mean, xlim = c(0, 4.55), 
     ylim = c(0.0, 0.75), type = "p", pch = 21, bg = "blue", 
     col = "blue", cex = 2, ylab = "", xlab = "", 
     cex.lab = 1.5, las = 1, lwd = 2, yaxt = "n", xaxt = "n")
box(lwd=2)

# Add minimal points
points(size.min$time.x, size.min$mean, pch = 21, 
      bg = "red", col = "red", lwd = 2, cex = 2)

# Add error bars
arrows(x0 = size.wt$time.x, y0 = size.wt$mean, 
       y1 = size.wt$mean + size.wt$sem, 
       angle = 90, length = 0.1, lwd = 2, col = "blue")
arrows(x0 = size.wt$time.x, y0 = size.wt$mean, 
       y1 = size.wt$mean - size.wt$sem, 
       angle = 90, length=0.1, lwd = 2, col = "blue")
arrows(x0 = size.min$time.x, y0 = size.min$mean, 
       y1 = size.min$mean + size.min$sem, 
       angle = 90, length = 0.1, lwd = 2, col = "red")
arrows(x0 = size.min$time.x, y0 = size.min$mean, 
       y1 = size.min$mean - size.min$sem, 
       angle = 90, length=0.1, lwd = 2, col = "red")

# Add axes and labels
axis(side = 2, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("0.00", "0.25", "0.50", "0.75"), at = c(0, 0.25, 0.5, 0.75))
axis(side = 4, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at=c(0, 0.25, 0.5, 0.75), labels = F)
axis(side = 3, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at = c(1, 3), labels = F)
axis(side = 1, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("Ancestor", "Evolved"), 
     col.axis = "darkgray", at = c(1, 3))
mtext(expression('Timepoint'), side = 1,
      outer = TRUE, cex = 1.5, line = -3.5, adj = 0.45)

mtext(expression(paste("Cell volume (",mu, "m" ^3* ")")), side = 2, 
      outer = TRUE, cex = 1.5, line = -3, adj = 0.55)

# Add line segments
segments(size.wt$time.x[1], size.wt$mean[1], size.wt$time.x[2], 
         size.wt$mean[2], col = "blue", lwd = 2)
segments(size.min$time.x[1], size.min$mean[1], size.min$time.x[2], 
         size.min$mean[2], col = "red", lwd = 2)

# Add P-values
mtext(expression("Timepoint x Strain:"), line = -2.5, cex = 0.8, at = 0.9)
mtext(expression(~italic("P")~"< 0.0001"), line = -3.5, cex = 0.8, at = 0.9)

# Add strain identifier
text(3.8, size.wt$mean[2], labels = "Wildtype", cex = 1.0)
text(3.8, size.min$mean[2], labels = "Minimal", cex = 1.0)

# Close Plot Device
dev.off()
graphics.off()

# Show Plot
img <- readPNG("~/GitHub/MinimalCell/figures/Fig4.png")

grid.raster(img)
```