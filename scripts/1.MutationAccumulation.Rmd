---
title: "Evolution of the minimal cell"
author: "Roy Moger-Reischer and Jay T. Lennon"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
   - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

## Clear workspace and set directory
```{r setup}
rm(list=ls())
getwd()
setwd("~/GitHub/MinimalCell")
```

## Load packages and functions
```{r}
require("png")
require("dplyr")
require("vioplot")
require("grid")
require("DescTools")
require("RVAideMemoire")
```

## Mutation accumulation (MA)

# Load mutation rate data for Fig. 1A
```{r}
# Load mutation rate data
ma.raw <- read.csv("data2/MA_summary_for_R.csv", header = TRUE, sep =",")

# Preserve row names
ma <- as_tibble(ma.raw)

# Set data as factors and rename levels
ma$strain <- as.factor(ma$strain)
levels(ma$strain)[levels(ma$strain)=="MA_s1"] <- "Wildtype"
levels(ma$strain)[levels(ma$strain)=="MA_3B"] <- "Minimal"
ma$strain <- factor(ma$strain, levels=c("Wildtype","Minimal"))

# Subset mutation rate data by strain
mr.wt  <- filter(ma, strain== "Wildtype") %>%
  dplyr::select(per_nt_per_gen)

mr.min  <- filter(ma, strain== "Minimal") %>%
  dplyr::select(per_nt_per_gen)
```

# Load mutation type data (i.e., insertions, deletions, and SMSs) for Fig. 1B)
```{r}
# Load data
ma.type.raw <- read.csv("data2/MA_grouped_bar_mut.types.csv")

# Preserve row names
ma.type <- as_tibble(ma.type.raw)

# Set data as factors and rename levels
ma.type$strain <- as.factor(ma.type$strain)
ma.type$mut <- as.factor(ma.type$mut)
levels(ma.type$strain)[levels(ma.type$strain)=="s1"] <- "Wildtype"
levels(ma.type$strain)[levels(ma.type$strain)=="3B"] <- "Minimal"
levels(ma.type$mut)[levels(ma.type$mut)=="SNM"] <- "Single-nucleotide"
ma.type$strain <- factor(ma.type$strain, levels=c("Wildtype","Minimal"))
ma.type$mut <- factor(ma.type$mut, levels = c("Insertion","Deletion","Over 100 bp","Single-nucleotide"))
ma.type <- ma.type %>% mutate(prop2 = sprintf("%0.2f",prop))

# Reorder for plotting
order.1 <- c(2,4,6,1,3,5) 
ma.type <- data.frame(ma.type,order.1)
ma.type <- ma.type[order(ma.type$order.1),] 

# Make table for contingency analyses
ma.type.mat <- matrix(ma.type$count, ncol =2, byrow=F)
colnames(ma.type.mat) <- c("minimal","wildtype")
rownames(ma.type.mat) <- c("insertion","deletion","snm")
ma.type.tab <- as.table(ma.type.mat)
ma.type.tab.margins <- addmargins(ma.type.tab)

ma.type.chi <- chisq.test(ma.type.tab)
# X-squared = 500.51, df = 2, p-value < 2.2e-16

ma.type.fish <- fisher.test(ma.type.tab)
# p-value < 2.2e-16

ma.type.mult <- fisher.multcomp(ma.type.tab, p.method = "fdr")
#           insertion  deletion
# deletion  2.310e-46         -
# snm       3.297e-04 3.812e-81
```

# Load single nucleotide mutation data for Fig. 1C
```{r}
# Load data
ma.snm.raw <- read.csv("data2/MA_grouped_bar_SNM.csv")

# Preserve row names
ma.snm <- as_tibble(ma.snm.raw)

# Set data as factors and rename levels
ma.snm$strain <- as.factor(ma.snm$strain)
ma.snm$mut <- as.factor(ma.snm$mut)
levels(ma.snm$strain)[levels(ma.snm$strain)=="s1"] <- "Wildtype"
levels(ma.snm$strain)[levels(ma.snm$strain)=="3B"] <- "Minimal"
ma.snm$strain <- factor(ma.snm$strain, levels=c("Wildtype","Minimal"))
ma.snm$mut <- factor(ma.snm$mut, levels = 
    c("A:T to C:G","A:T to G:C","A:T to T:A",
    "C:G to G:C", "C:G to T:A", "C:G to A:T"))
ma.snm <- ma.snm %>% mutate(prop2 = sprintf("%0.2f",prop))

# Reorder table for plotting
order.2 <- c(2,4,6,8,10,12,1,3,5,7,9,11) 
ma.snm <- data.frame(ma.snm,order.2)
ma.snm <- ma.snm[order(ma.snm$order.2),] 

# Make table for contingency analyses
ma.snm.mat <- matrix(ma.snm$count, ncol = 2, byrow = T)
colnames(ma.snm.mat) <- c("wildtype","minimal")
rownames(ma.snm.mat) <- c("A:T to C:G","A:T to G:C","A:T to T:A", "C:G to G:C",
              "C:G to T:A", "C:G to A:T")
ma.snm.tab <- as.table(ma.snm.mat)
ma.snm.tab.margins <- addmargins(ma.snm.tab)

ma.snm.chi <- chisq.test(ma.snm.tab)
# X-squared = 122.4, df = 5, p-value < 2.2e-16

ma.snm.fish <- fisher.test(ma.snm.tab, workspace = 2e8)
# p-value < 2.2e-16

ma.snm.mult <- fisher.multcomp(ma.snm.tab, p.method = "fdr")
#            A:T to C:G A:T to G:C A:T to T:A C:G to G:C C:G to T:A
# A:T to G:C  0.0061070          -          -          -          -
# A:T to T:A  0.7965475  5.291e-04          -          -          -
# C:G to G:C  0.0002467  0.2175     5.628e-07          -          -
# C:G to T:A  0.7248613  3.478e-11  0.1718     1.667e-20          -
# C:G to A:T  0.3559718  2.983e-04  0.3560     5.753e-09  3.801e-10
```

# Make Figure 1
```{r}
### Initiate figure
png(filename="~/GitHub/MinimalCell/figures/Fig1.png",
    width = 1200, height = 1200, res = 96*2) 

plot.new()
layout(matrix(c(1:3), byrow = T))
par(mar = c(2.5, 4, 1, 1), oma = c(3, 4, 1, 1))

### Make panel A ###

# Add ghost points
plot(jitter(rep(0.75, nrow(mr.wt)), amount = 0.1), mr.wt$per_nt_per_gen, 
     ylim = c(1e-09, 8e-08), xlim = c(0, 3), pch = 21, col = "white", 
     bg = "white", lwd = 2, cex = 1.7, yaxt = "n", xaxt = "n", cex.lab = 2, 
     cex.axis= 1.25, las = 1, ylab = "", xlab = "")
box(lwd=2) 

# Add violins
vioplot(mr.wt, col="lightblue", horizontal = F, at = 0.75, add = T, lty = 1, drawRect = F)
vioplot(mr.min, col="pink", horizontal = F, at = 2.25, add = T, lty = 1, drawRect = F)

# Add points on top of violins
points(jitter(rep(0.75, nrow(mr.wt)), amount = 0.1), mr.wt$per_nt_per_gen,
       pch = 21, col = "blue", bg = "blue", cex = 0.5)
points(jitter(rep(2.25, nrow(mr.min)), amount = 0.1), mr.min$per_nt_per_gen,
       pch = 21, col = "red", bg = "red", cex = 0.5)

# Add axes
axis(side = 2, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c(expression(paste("1·10"^"-8")), expression(paste("3·10"^"-8")), 
      expression(paste("5·10"^"-8")), expression(paste("7·10"^"-8"))), 
      at = c(1e-08, 3e-08, 5e-08, 7e-08))
axis(side = 4, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at=c(1e-08, 3e-08, 5e-08, 7e-08), labels = F)
axis(side = 3, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at = c(0.75, 2.25), labels = F)
axis(side = 1, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("Wildtype", "Minimal"), at = c(0.75, 2.25))

# Add y-axis label
mtext("Mutation rate", side = 2, outer = TRUE, cex = 1.25, line = 2, adj = 0.94)
mtext(expression(paste('(mut · nt'^-1*' · gen' ^-1*')')), 
      side = 2, outer = TRUE, cex = 0.70, line = 0.55, adj = 0.925)      

# Test for equal variance: P = 0.42 --> homogeneous variance
equal.var <- var.test(mr.wt$per_nt_per_gen, mr.min$per_nt_per_gen)

# Test for differences between treatments: P = 0.54 --> no difference
mr.ttest <- t.test(mr.wt$per_nt_per_gen, mr.min$per_nt_per_gen, var.equal = TRUE)

#Add panel label
text(-0.025, 7.5e-08, labels = "A", cex = 2)

#Add P-value for t-test
mtext(expression(~italic("P")~"= 0.54"), line = -3.5, cex = 0.80, at = 0.09)


### Make panel B ###

barplot(ma.type$prop, col = c("blue", "red", "blue", "red", "blue", "red"), 
        ylim = c(0,1), space = c(1,0,1,0,1,0), las =1, yaxt = "n", xaxt = "n")
box(lwd=2) 

# Add axes
axis(side = 2, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("0.00", "0.50", "1.00"), 
      at = c(0, 0.5, 1.0))
axis(side = 4, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at=c(0, 0.5,1.0), labels = F)

# Add x-axis labels
text(2.0, -0.1, expression("Insertions"), cex= 1.25, srt = 0, xpd = NA)
text(5.0, -0.1, expression("Deletions"), cex= 1.25, srt = 0, xpd = NA)
text(8.0, -0.1, expression("SNM"), cex= 1.25, srt = 0, xpd = NA)

# Add y-axis label
mtext("Proportion", side = 2, outer = TRUE, cex = 1.25, line = 2, adj = 0.52)

# Add bar value
text(1.5, 0.10, expression("0.02"), cex= 0.85)
text(2.5, 0.09, expression("0.03"), cex= 0.85)
text(4.5, 0.15, expression("0.09"), cex= 0.85)
text(5.5, 0.16, expression("0.10"), cex= 0.85)
text(7.5, 0.95, expression("0.89"), cex= 0.85)
text(8.5, 0.92, expression("0.86"), cex= 0.85)

# Add panel label
text(0.9, 0.9, labels = "B", cex = 2)

# Add legend
legend(0.75, 0.8, c("Wildtype", "Minimal"), pch = 22, 
       pt.bg = c("blue", "red"), pt.cex = 2, pt.lwd = 1.5, 
       bty = 'n', y.intersp = 1)

# Add P-value for t-test
mtext(expression(~italic("P")~"< 0.0001"), line = -6.8, cex = 0.80, at = 1.4)


### Make panel C ###

barplot(ma.snm$prop, col = c("blue", "red", "blue", "red", "blue", "red", 
        "blue", "red", "blue", "red", "blue", "red"), ylim = c(0,1), 
        space = c(1,0,1,0,1,0,1,0,1,0,1,0), las =1, yaxt = "n", xaxt = "n")
box(lwd=2) 

# Add axes
axis(side = 2, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("0.00", "0.50", "1.00"), 
      at = c(0, 0.5, 1.0))
axis(side = 4, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at=c(0, 0.5,1.0), labels = F)

# Add x-axis labels
text(2, -0.075, expression("A:T → C:G"), cex= 1, srt = 0, xpd = NA)
text(5, -0.075, expression("A:T → G:C"), cex= 1, srt = 0, xpd = NA)
text(8, -0.075, expression("A:T → T:A"), cex= 1, srt = 0, xpd = NA)
text(11, -0.075, expression("C:G → G:C"), cex= 1, srt = 0, xpd = NA)
text(14, -0.075, expression("C:G → T:A"), cex= 1, srt = 0, xpd = NA)
text(17, -0.075, expression("C:G → A:T"), cex= 1, srt = 0, xpd = NA)

# Add y-axis label
mtext("Proportion", side = 2, outer = TRUE, cex = 1.25, line = 2, adj = 0.125)

# Add bar value
text(1.5, 0.06, expression("0.01"), cex= 0.85)
text(2.5, 0.06, expression("0.01"), cex= 0.85)
text(4.5, 0.13, expression("0.07"), cex= 0.85)
text(5.5, 0.08, expression("0.02"), cex= 0.85)
text(7.5, 0.10, expression("0.04"), cex= 0.85)
text(8.5, 0.10, expression("0.04"), cex= 0.85)
text(10.5, 0.16, expression("0.10"), cex= 0.85)
text(11.5, 0.07, expression("0.01"), cex= 0.85)
text(13.5, 0.48, expression("0.42"), cex= 0.85)
text(14.5, 0.71, expression("0.65"), cex= 0.85)
text(16.5, 0.40, expression("0.36"), cex= 0.85)
text(17.5, 0.33, expression("0.27"), cex= 0.85)

# Add panel label
text(0.9, 0.9, labels = "C", cex = 2)

# Add legend
legend(0.55, 0.8, c("Wildtype", "Minimal"), pch = 22, 
       pt.bg = c("blue", "red"), pt.cex = 2, pt.lwd = 1.5, 
       bty = 'n', y.intersp = 1)

# Add P-value for t-test
mtext(expression(~italic("P")~"< 0.0001"), line = -6.8, cex = 0.80, at = 2.0)

# Close Plot Device
dev.off()
graphics.off()

# Show Plot
img <- readPNG("~/GitHub/MinimalCell/figures/Fig1.png")

grid.raster(img)
```